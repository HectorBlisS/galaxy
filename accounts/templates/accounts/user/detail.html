{%extends 'base.html'%}
{%load static%}

{%block content%}

	<h1>{{user.get_full_name}}</h1>
	<div id="profile-info">

		<div class="user">
			<a href="{{user.get_absolute_url}}">
				{% if u.profile.avatar %}
					<img width="100" class="avatar-circle" src="/media/{{u.profile.avatar.url}}">
				{% else %}
					<img width="100" class="avatar-circle" src="{%static 'images/geek_paFace.png'%}">	
				{% endif %}
			</a>

			<div class="info">
				
				{%with total_followers=user.followers.count%}
				<span class="count">
					<span class="total">{{total_followers}}</span>
					follower{{total_followers|pluralize}}
				</span>
				{%if not request.user == user%}
				<a href="#!" data-id="{{user.id}}" data-action="{%if request.user in user.followers.all%}un{%endif%}follow" class="follow button">
					{%if request.user not in user.followers.all%}
					Follow
					{%else%}
					Unfollow
					{%endif%}
				</a>
				{%endif%}
				{%endwith%}
			</div>
		</div>

	</div>
{%endblock content%}

{%block domready%}

$('a.follow').click(function(e){
	e.preventDefault();
	$.post('{%url "user_follow"%}',
	{
		id:$(this).data('id'),
		action:$(this).data('action')
	},
	function(data){
		console.log(data['status']);
		if(data['status'] == 'ok'){
			var previous_action = $('a.follow').data('action');
			// toggle data-action
			$('a.follow').data('action',previous_action == 'follow' ? 'unfollow':'follow');
			//toggle link text
			$('a.follow').text(previous_action == 'follow' ? 'Unfollow':'Follow');
			// update total followers
			var previous_followers = parseInt($('.total').text());
			console.log(previous_followers);
			$('.total').text(previous_action == 'follow' ? previous_followers +1:previous_followers -1);
		}
	});
});

{%endblock domready%}